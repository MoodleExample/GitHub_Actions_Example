on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]
  workflow_dispatch:
    branches: [ master ]

jobs:
  Build-CC:
    runs-on: ubuntu-latest
    steps:
    - name: Download, configure and install gtest
      run: |
        wget https://github.com/google/googletest/archive/release-1.10.0.tar.gz
        tar xf release-1.10.0.tar.gz
        cd googletest-release-1.10.0
        cmake -DBUILD_SHARED_LIBS=OFF .
        sudo make install

    - name: Checkout the project
      uses: actions/checkout@v2

    - name: Build
      run: |
        mkdir build
        cd build
        cmake -DCMAKE_BUILD_TYPE=Debug -DCMAKE_CXX_FLAGS="-Werror" ..
        make
    - name: Google Test
      run: |
        /home/runner/work/GitHub_Actions_Example/GitHub_Actions_Example/build/test/github_actions_gtest_example.test --gtest_output=json:./result-CC.json
    - name: Save Test Result
      if: ${{ always() }}
      uses: actions/upload-artifact@v3
      with:
        name: TestResult
        path: ./result-CC.json  
  
  Build-C:
    runs-on: ubuntu-latest
    steps:
    - name: Download, configure and install gtest
      run: |
        wget https://github.com/google/googletest/archive/release-1.10.0.tar.gz
        tar xf release-1.10.0.tar.gz
        sudo cp -rf googletest-release-1.10.0 /usr/local
        cd googletest-release-1.10.0
        cmake -DBUILD_SHARED_LIBS=OFF .
        sudo make install

    - name: Checkout the project
      uses: actions/checkout@v2

    - name: Build
      run: |
        cd src/func1
        make
    - name: Google Test
      run: |
        ls ./src/func1
        ls ./test
        ./src/func1/func1.test --gtest_output=json:./result-C.json
    - name: Save Test Result
      uses: actions/upload-artifact@v3
      if: ${{ always() }}
      with:
        name: TestResult
        path: ./result-C.json  
        
  Inspection:
    if: ${{ always() }}
    needs: [Build-CC, Build-C]
    runs-on: ubuntu-latest
    steps:
      - name: Load Test Result
        uses: actions/download-artifact@v3
        with:
          name: TestResult
      - name: Analyze Google test Result
        run: |
          ls
      - name: Clone Wiki
        uses: actions/checkout@v2
        with:
          repository: MoodleExample.wiki
          path: .wiki

          
      
